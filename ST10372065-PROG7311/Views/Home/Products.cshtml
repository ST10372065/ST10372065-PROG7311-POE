@{
    ViewData["Title"] = "Products";
}

<div class="menu-toggle">☰</div>

<nav class="nav-container">
    <div class="close-btn">×</div>
    <ul class="nav-menu">
        <li><a href="#home">Home</a></li>
        <li><a href="/Home/Products">Products</a></li>
        @if (User.Identity.IsAuthenticated)
        {
            <li>
                <span class="nav-link">Welcome, @User.FindFirst("FirstName")?.Value!</span>
            </li>
            <li>
                <form asp-controller="Home" asp-action="Logout" method="post" style="display:inline;">
                    <button type="submit" class="btn btn-link nav-link">Logout</button>
                </form>
            </li>
        }
        else
        {
            <li><a href="#" data-bs-toggle="modal" data-bs-target="#loginModal">Login</a></li>
        }
    </ul>
</nav>

<!-- Centered Header -->
<h1 class="text-center my-4">Products</h1>

<!-- Display ModelState Errors -->
@if (!ViewData.ModelState.IsValid)
{
    <div class="alert alert-danger">
        <ul>
            @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
            {
                <li>@error.ErrorMessage</li>
            }
        </ul>
    </div>
}

<!-- Form to Add a New Product -->
<div class="add-product-form mb-5">
    <h2>Add a New Product</h2>
    <form asp-action="AddProduct" method="post" enctype="multipart/form-data">
        <div class="mb-3">
            <label for="ProductName" class="form-label">Product Name</label>
            <input type="text" class="form-control" id="ProductName" name="ProductName" required />
        </div>
        <div class="mb-3">
            <label for="Category" class="form-label">Category</label>
            <input type="text" class="form-control" id="Category" name="Category" required />
        </div>
        <div class="mb-3">
            <label for="Price" class="form-label">Price</label>
            <input type="number" step="0.01" class="form-control" id="Price" name="Price" required />
        </div>
        <div class="mb-3">
            <label for="Image" class="form-label">Product Image</label>
            <input type="file" class="form-control" id="Image" name="Image" accept="image/*" required />
        </div>
        <div class="mb-3">
            <label for="Date" class="form-label">Production Date</label>
            <input type="date" class="form-control" id="Date" name="Date" required />
        </div>
        <button type="submit" class="btn btn-primary">Add Product</button>
    </form>
</div>

<hr />

<!-- Display Products as Cards -->
<div class="container">
    <div class="row">
        @if (ViewBag.Products != null && ViewBag.Products.Count > 0)
        {
            foreach (var product in ViewBag.Products)
            {
                <div class="col-md-4 mb-4">
                    <div class="card h-100">
                        <img src="@product.ImageUrl" class="card-img-top" alt="@product.ProductName" style="object-fit:cover; height:200px;">
                        <div class="card-body">
                            <h5 class="card-title">@product.ProductName</h5>
                            <p class="card-text">Category: @product.Category</p>
                            <p class="card-text">Price: R @product.Price</p>
                            <p class="card-text"><small class="text-muted">Produced on: @product.Date.ToString("yyyy-MM-dd")</small></p>
                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="col-12">
                <p class="text-center">No products available.</p>
            </div>
        }
    </div>
</div>
